---
# HAProxy Start and Verify Playbook
# Configures HAProxy for Kubernetes API and verifies the setup

- name: Configure and Verify HAProxy for Kubernetes API
  hosts: haproxy_spb
  become: true
  gather_facts: true
  vars_files:
    - ../../vault_secrets.yml
    - roles/haproxy_k8s/defaults/main.yaml
  tags:
    - haproxy
    - kubernetes
    - loadbalancer
  roles:
    - haproxy_k8s

- name: Verify HAProxy Configuration
  hosts: haproxy_spb
  become: true
  gather_facts: true
  vars_files:
    - ../../vault_secrets.yml
    - roles/haproxy_k8s/defaults/main.yaml
    - roles/haproxy_verify/defaults/main.yaml
  tags:
    - haproxy
    - verify
    - test
  roles:
    - haproxy_verify
