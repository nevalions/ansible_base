---
traefik_enabled: "{{ vault_traefik_enabled | default(true) }}"

# Operation mode for this role
# - install: install/configure Traefik via Helm
# - verify: verify Traefik resources and external IP
# - remove: uninstall Traefik (and optionally the namespace)
traefik_operation: "{{ vault_traefik_operation | default('install') }}"

traefik_namespace: "{{ vault_traefik_namespace | default('traefik') }}"
traefik_release_name: "{{ vault_traefik_release_name | default('traefik') }}"

traefik_chart_ref: "{{ vault_traefik_chart_ref | default('traefik/traefik') }}"
traefik_chart_version: "{{ vault_traefik_chart_version | default('') }}"  # empty = latest

traefik_helm_binary_path: "{{ vault_traefik_helm_binary_path | default('/usr/local/bin/helm') }}"

# MetalLB integration
# Auto-assign is the default; set a specific IP only if you need it.
traefik_load_balancer_ip: "{{ vault_traefik_load_balancer_ip | default('') }}"

# Optional: force selection of a specific MetalLB pool (usually not needed when only 1 pool exists)
traefik_metallb_address_pool_name: "{{ vault_traefik_metallb_address_pool_name | default('') }}"

# IngressClass behavior
traefik_ingress_class_enabled: "{{ vault_traefik_ingress_class_enabled | default(true) }}"
traefik_ingress_class_is_default: "{{ vault_traefik_ingress_class_is_default | default(true) }}"

# Security defaults
traefik_dashboard_enabled: "{{ vault_traefik_dashboard_enabled | default(false) }}"

# HTTPS readiness (cert-manager recommended for real certs)
traefik_tls_enabled: "{{ vault_traefik_tls_enabled | default(true) }}"
traefik_http_redirect_to_https: "{{ vault_traefik_http_redirect_to_https | default(true) }}"

# ACME certificate resolver (Let's Encrypt)
traefik_certresolver_enabled: "{{ vault_traefik_certresolver_enabled | default(false) }}"
traefik_certresolver_name: "{{ vault_traefik_certresolver_name | default('letsencrypt') }}"
traefik_acme_email: "{{ vault_traefik_acme_email }}"
traefik_acme_storage: "{{ vault_traefik_acme_storage | default('/data/acme.json') }}"
traefik_acme_httpchallenge_entrypoint: "{{ vault_traefik_acme_httpchallenge_entrypoint | default('web') }}"
traefik_acme_use_ipv4: "{{ vault_traefik_acme_use_ipv4 | default(true) }}"

# Persist ACME storage (recommended)
# By default, Traefik stores ACME state in /data/acme.json.
# If /data is backed by emptyDir, certs disappear when the Traefik pod is recreated.
traefik_persistence_enabled: "{{ vault_traefik_persistence_enabled | default(false) }}"
traefik_persistence_access_mode: "{{ vault_traefik_persistence_access_mode | default('ReadWriteOnce') }}"
traefik_persistence_size: "{{ vault_traefik_persistence_size | default('1Gi') }}"
traefik_persistence_storage_class: "{{ vault_traefik_persistence_storage_class | default('') }}"
traefik_persistence_existing_claim: "{{ vault_traefik_persistence_existing_claim | default('') }}"

# Removal behavior
traefik_remove_namespace: "{{ vault_traefik_remove_namespace | default(false) }}"

# Optional: wait for EXTERNAL-IP on install
traefik_wait_for_external_ip: "{{ vault_traefik_wait_for_external_ip | default(true) }}"

# PROXY protocol for real client IPs (requires HAProxy to send-proxy-v2)
traefik_external_traffic_policy: "{{ vault_traefik_external_traffic_policy | default('Local') }}"
traefik_proxy_protocol_enabled: "{{ vault_traefik_proxy_protocol_enabled | default(false) }}"
traefik_proxy_protocol_trusted_ips: "{{ vault_traefik_proxy_protocol_trusted_ips | default([]) }}"

# Replica count (2 = recommended for rolling updates and basic HA)
traefik_replica_count: "{{ vault_traefik_replica_count | default(2) }}"
