# WireGuard Server Configuration - {{ vault_wg_interface }}
# Generated by Ansible - DO NOT EDIT MANUALLY
# Last updated: {{ ansible_date_time.iso8601 }}

[Interface]
Address = {{ vault_wg_server_ip }}/{{ vault_wg_network_cidr.split('/')[1] }}
PrivateKey = {{ vault_wg_server_private_key }}
ListenPort = {{ vault_wg_server_port }}

# BEGIN ANSIBLE MANAGED PEERS
{% for peer in vault_wg_peers %}
[Peer]
# {{ peer.name }} - {{ peer.host_group | default('unknown') }}
PublicKey = {{ vault_wg_peer_public_keys[peer.name] }}
AllowedIPs = {{ peer.allowed_ips }}
{% if peer.endpoint is defined %}
Endpoint = {{ peer.endpoint | replace('{{ vault_wg_server_port }}', vault_wg_server_port) | replace('{{ vault_wg_client_default_port }}', vault_wg_client_default_port) }}
{% endif %}
PersistentKeepalive = 25
{% endfor %}
# END ANSIBLE MANAGED PEERS
