# WireGuard Client Configuration for {{ peer_config.name }}
# Generated by Ansible - DO NOT EDIT MANUALLY

[Interface]
Address = {{ peer_config.address | default(peer_config.allowed_ips) }}
PrivateKey = {{ peer_private_key }}
{% if peer_config.client_listen_port is defined %}
ListenPort = {{ peer_config.client_listen_port }}
{% else %}
ListenPort = {{ vault_wg_client_default_port }}
{% endif %}
{% if wg_use_dns | default(true) %}
DNS = {{ vault_wg_dns_primary | default(vault_dns_server_primary | default('[dns-server-ip]')) }}
{% endif %}

# BEGIN ANSIBLE MANAGED PEERS
{% for server_peer in vault_wg_peers %}
{%   if server_peer.name != peer_config.name %}
[Peer]
# {{ server_peer.name }} - {{ server_peer.host_group | default('unknown') }}
PublicKey = {{ vault_wg_peer_public_keys[server_peer.name] }}
Endpoint = {{ server_peer.endpoint }}
AllowedIPs = {{ server_peer.allowed_ips | default(server_peer.address) }}{% if (server_peer.is_server | default(false)) and (vault_wg_routed_cidrs | default([]) | length > 0) %}, {{ vault_wg_routed_cidrs | join(', ') }}{% endif %}

PersistentKeepalive = 25
{%   endif %}
{% endfor %}
# END ANSIBLE MANAGED PEERS
