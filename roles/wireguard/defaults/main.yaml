---
skip_folder_check: true

wg_operation: "install"

# Network Configuration
vault_wg_interface: "[interface-name]"
vault_wg_network_cidr: "[vpn-network-cidr]"
vault_wg_server_ip: "[server-vpn-ip]"
vault_wg_server_port: "[server-port]"
vault_wg_client_default_port: "[client-default-port]"
vault_wg_client_port_start: "[port-range-start]"
vault_wg_client_port_end: "[port-range-end]"
vault_wg_dns_primary: "[dns-server-ip]"
wg_dns_enabled: true

# Keys (stored in vault_secrets.yml)
vault_wg_server_private_key: null
vault_wg_server_public_key: null
vault_wg_peer_private_keys: {}
vault_wg_peer_public_keys: {}

# WireGuard Peers Configuration
# Each peer/server definition includes:
# - name: Unique identifier (must match vault_wg_peer_private_keys and vault_wg_peer_public_keys)
# - host_group: Maps to Ansible inventory group name
# - allowed_ips: VPN IP address for this peer/server (used in AllowedIPs)
# - endpoint: Public or internal IP:PORT for connecting
# - client_listen_port: UDP port for incoming WireGuard connections
# - is_server: (optional) true for servers that route pod network traffic
#              When true, vault_wg_routed_cidrs (e.g., Calico pod CIDR) is added
#              to AllowedIPs in client configs for this peer
#
# NAT Configuration:
# - For servers behind NAT: Use public IP with unique port per server
# - Port forward: Public:PORT â†’ Internal:PORT on gateway
# - For clients connecting to local servers: Use internal IP to avoid NAT hairpin
vault_wg_peers: []

# Per-host server IP addresses for multi-server mesh
# Each server gets unique VPN IP for peer connections
# Maps inventory group name to VPN IP address
vault_wg_server_ips:
  # Example:
  # [server-name-a]: "[vpn-ip-a]"  # Public server
  # [server-name-b]: "[vpn-ip-b]"     # Control plane 1
  # [server-name-c]: "[vpn-ip-c]"       # BGP server

# Multi-Server Peer Architecture
#
# Benefits:
# - Redundancy: Peers connect to ALL servers, not just one hub
# - Failover: If one server fails, peers automatically use remaining servers
# - Load Distribution: Traffic can distribute across multiple servers
#
# Implementation:
# - Peers include [Peer] section for each server
# - Each [Peer] uses specific AllowedIPs (e.g., [vpn-ip-a]/32)
# - NOT network CIDR ([vpn-network-cidr]) which causes routing conflicts
#
# Client Configuration Example:
# [Peer] # [server-name-a]
#   AllowedIPs = [vpn-ip-a]/32
# [Peer] # [server-name-c]
#   AllowedIPs = [vpn-ip-c]/32
# [Peer] # [server-name-b]
#   AllowedIPs = [vpn-ip-b]/32

# Firewall Configuration
vault_wg_allowed_networks:
   - "[physical-network-cidr]"
   - "[vpn-network-cidr]"
   - "127.0.0.0/8"

# Routed CIDRs (optional, legacy)
# Networks that are routed through WireGuard server peers.
# These CIDRs are added to AllowedIPs for ALL peers with is_server: true.
# Prefer vault_wg_peers_extra_cidrs for explicit per-peer control.
vault_wg_routed_cidrs: []

# Per-peer extra AllowedIPs (explicit, authoritative)
# Maps peer name to list of additional CIDRs to append to that peer's AllowedIPs.
# These are added on TOP of the peer's base allowed_ips/address.
# Takes precedence over the legacy is_server+vault_wg_routed_cidrs mechanism.
#
# Example:
#   vault_wg_peers_extra_cidrs:
#     bay_bgp: ["11.11.0.0/24"]          # MetalLB pool - BGP router routes to workers
#     bay_worker2: ["10.244.0.0/16"]     # Pod CIDR - return path for Traefik replies
#     bay_worker_office1: ["10.244.0.0/16"]
#     bay_worker_super1: ["10.244.0.0/16"]
#     vas_worker1: ["10.244.0.0/16"]
vault_wg_peers_extra_cidrs: {}

# Deprecated: Primary server peer name for routed CIDRs
# Use vault_wg_peers_extra_cidrs instead
vault_wg_primary_server_name: ""
