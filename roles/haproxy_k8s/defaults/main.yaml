---
# =============================================================================
# Kubernetes API Load Balancing (existing)
# =============================================================================
haproxy_k8s_frontend_port: "{{ vault_k8s_api_port | default(vault_haproxy_k8s_frontend_port | default(6443)) }}"
haproxy_k8s_backend_port: "{{ vault_haproxy_k8s_backend_port | default(6443) }}"

haproxy_k8s_backend_hosts:
  - name: "control-plane-1"
    wireguard_ip: "{{ vault_haproxy_k8s_backend_ip | default('[control-plane-wg-ip]') }}"
    backend_port: "{{ haproxy_k8s_backend_port }}"

# Networks allowed to access K8s API via HAProxy (empty list = skip UFW rules for K8s API)
haproxy_k8s_allowed_networks: "{{ vault_haproxy_k8s_allowed_networks | default([]) }}"

# Skip UFW configuration for K8s API (useful if already configured or not needed)
haproxy_k8s_skip_ufw: "{{ vault_haproxy_k8s_skip_ufw | default(true) }}"

# =============================================================================
# Ingress Load Balancing (HTTP/HTTPS to Kubernetes via BGP VIP)
# =============================================================================
# Enable/disable ingress forwarding (ports 80/443)
haproxy_ingress_enabled: "{{ vault_haproxy_ingress_enabled | default(false) }}"

# Frontend ports (what HAProxy listens on)
haproxy_ingress_http_port: "{{ vault_haproxy_ingress_http_port | default(80) }}"
haproxy_ingress_https_port: "{{ vault_haproxy_ingress_https_port | default(443) }}"

# Backend target (BGP VIP that routes to MetalLB/Traefik)
haproxy_ingress_backend_ip: "{{ vault_haproxy_ingress_backend_ip | default('[bgp-vip-address]') }}"
haproxy_ingress_backend_http_port: "{{ vault_haproxy_ingress_backend_http_port | default(80) }}"
haproxy_ingress_backend_https_port: "{{ vault_haproxy_ingress_backend_https_port | default(443) }}"

# =============================================================================
# Common Settings
# =============================================================================
haproxy_k8s_maxconn: 1000
haproxy_k8s_timeout_connect: 5000
haproxy_k8s_timeout_client: 30000
haproxy_k8s_timeout_server: 30000
haproxy_k8s_check_interval: 2000
haproxy_k8s_check_rise: 2
haproxy_k8s_check_fall: 3

# PROXY protocol for real client IPs (requires Traefik to accept proxyProtocol)
haproxy_ingress_proxy_protocol: "{{ vault_haproxy_ingress_proxy_protocol | default(false) }}"

# =============================================================================
# Mail Server Load Balancing (SMTP/IMAP to Kubernetes via MetalLB)
# =============================================================================
# Enable/disable mail server forwarding (ports 25, 465, 587, 993)
haproxy_mail_enabled: "{{ vault_haproxy_mail_enabled | default(false) }}"

# Frontend ports (what HAProxy listens on — public internet)
haproxy_mail_smtp_port: "{{ vault_haproxy_mail_smtp_port | default(25) }}"
haproxy_mail_smtps_port: "{{ vault_haproxy_mail_smtps_port | default(465) }}"
haproxy_mail_submission_port: "{{ vault_haproxy_mail_submission_port | default(587) }}"
haproxy_mail_imaps_port: "{{ vault_haproxy_mail_imaps_port | default(993) }}"

# Backend target (MetalLB IP assigned to stalwart-mail-lb Service)
haproxy_mail_backend_ip: "{{ vault_haproxy_mail_backend_ip | default('[mail-lb-ip]') }}"
haproxy_mail_backend_smtp_port: "{{ vault_haproxy_mail_backend_smtp_port | default(25) }}"
haproxy_mail_backend_smtps_port: "{{ vault_haproxy_mail_backend_smtps_port | default(465) }}"
haproxy_mail_backend_submission_port: "{{ vault_haproxy_mail_backend_submission_port | default(587) }}"
haproxy_mail_backend_imaps_port: "{{ vault_haproxy_mail_backend_imaps_port | default(993) }}"

# Mail-specific timeouts (longer than default — SMTP transactions can be slow)
haproxy_mail_timeout_client: "{{ vault_haproxy_mail_timeout_client | default(300000) }}"
haproxy_mail_timeout_server: "{{ vault_haproxy_mail_timeout_server | default(300000) }}"

# PROXY protocol for mail (disabled by default — Stalwart reads client IP natively)
haproxy_mail_proxy_protocol: "{{ vault_haproxy_mail_proxy_protocol | default(false) }}"
