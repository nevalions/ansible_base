# BEGIN ANSIBLE MANAGED SECTION
# Containerd configuration for Kubernetes {{ kubernetes_version | default('1.35') }}
# Generated by Ansible - Do not edit manually

version = 2

[plugins]
  [plugins."io.containerd.grpc.v1.cri"]
    # Sandbox image must match Kubernetes version requirements
    # K8s 1.35 requires pause:3.10.1
    sandbox_image = "registry.k8s.io/pause:{{ containerd_sandbox_image_tag | default('3.10') }}"

    [plugins."io.containerd.grpc.v1.cri".containerd]
      # Discard unpacked layers to save disk space (optional)
      discard_unpacked_layers = false

      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes]
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          runtime_type = "io.containerd.runc.v2"

          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
            # Use systemd cgroup driver (must match kubelet configuration)
            SystemdCgroup = true

    [plugins."io.containerd.grpc.v1.cri".cni]
      bin_dir = "/opt/cni/bin"
      conf_dir = "/etc/cni/net.d"

# END ANSIBLE MANAGED SECTION