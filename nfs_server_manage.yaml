---
- name: Manage NFS exports
  hosts: nfs_servers
  become: true
  vars:
    nfs_operation: "install"

    nfs_exports:
      - path: "{{ ADD_NFS_SERVER_EXPORTS_PATH }}"
        clients: "{{ ADD_NFS_SERVER_EXPORTS }}"
        options: "rw,sync,no_subtree_check"

    nfs_exports_to_remove:
      - path: "{{ REMOVE_NFS_SERVER_EXPORTS_PATH }}"
        clients: "{{ REMOVE_NFS_SERVER_EXPORTS }}"
        options: "rw,sync,no_subtree_check"
        remove_dir: false

  tasks:
    - name: Apply NFS server role
      ansible.builtin.include_role:
        name: nfs_server
      when: nfs_operation == "install"

    - name: Run NFS removal tasks
      ansible.builtin.include_tasks: roles/nfs_server/tasks/remove.yaml
      when: nfs_operation == "remove"
